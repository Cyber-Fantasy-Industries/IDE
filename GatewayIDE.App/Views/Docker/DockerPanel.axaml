<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="GatewayIDE.App.Views.Docker.DockerPanel">

  <!-- Nur anzeigen, wenn Docker-Tab aktiv -->
  <Grid IsVisible="{Binding Layout.IsDocker}"
        Margin="8"
        ClipToBounds="True">

    <!-- Main area: Units (left) + Logs (right) -->
    <Grid ColumnDefinitions="340,8,*"
          ClipToBounds="True">

      <!-- ================= LEFT: UNITS ================= -->
      <Border Grid.Column="0"
              BorderBrush="#444"
              BorderThickness="1"
              Padding="8">

        <Grid RowDefinitions="Auto,*">
          <TextBlock Text="Images"
                     FontWeight="SemiBold"
                     Foreground="#d8d8d8"
                     Margin="0,0,0,8"/>

          <ListBox Grid.Row="1"
                   ItemsSource="{Binding Docker.Units.Units}"
                   SelectedItem="{Binding Docker.Units.SelectedUnit, Mode=TwoWay}">

            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border BorderBrush="#333"
                        BorderThickness="1"
                        Padding="10"
                        Margin="0,0,0,8"
                        Background="#1b1b1b">

                  <!-- ================= UNIT CARD ================= -->
                  <!-- spacing via explicit spacer row -->
                  <Grid RowDefinitions="Auto,10,Auto">

                    <!-- ===== HEADER ===== -->
                    <Grid Grid.Row="0"
                          ColumnDefinitions="*,Auto,Auto"
                          VerticalAlignment="Center">

                      <!-- Name + Status -->
                      <StackPanel Grid.Column="0">
                        <TextBlock Text="{Binding DisplayName}"
                                   FontWeight="SemiBold"
                                   Foreground="#d8d8d8"/>
                        <TextBlock Text="{Binding StatusText}"
                                   Foreground="{Binding StatusBrush}"
                                   FontSize="12"/>
                      </StackPanel>

                      <!-- DEV / PROD -->
                      <ToggleSwitch Grid.Column="1"
                                    IsVisible="{Binding HasDevMode}"
                                    IsChecked="{Binding IsDev}"
                                    OnContent="DEV"
                                    OffContent="PROD"
                                    Margin="8,0"/>

                      <!-- Status Dot -->
                      <Border Grid.Column="2"
                              Width="10"
                              Height="10"
                              CornerRadius="99"
                              Background="{Binding StatusBrush}"
                              VerticalAlignment="Center"/>
                    </Grid>

                    <!-- spacer row: Grid.Row=1 is 10px -->

                    <!-- ===== ACTIONS (3 x 2) ===== -->
                    <!-- spacing via explicit spacer columns/rows -->
                    <Grid Grid.Row="2"
                          ColumnDefinitions="*,6,*,6,*"
                          RowDefinitions="Auto,6,Auto">

                      <!-- Row 1 -->
                      <Button Grid.Row="0" Grid.Column="0"
                              Content="Open"
                              Command="{Binding DataContext.Commands.OpenUnitCommand,
                                                RelativeSource={RelativeSource AncestorType=UserControl}}"
                              CommandParameter="{Binding}"/>

                      <Button Grid.Row="0" Grid.Column="2"
                              Content="Up"
                              Command="{Binding DataContext.Commands.StartGatewayCommand,
                                                RelativeSource={RelativeSource AncestorType=UserControl}}"
                              CommandParameter="{Binding}"/>

                      <Button Grid.Row="0" Grid.Column="4"
                              Content="Down"
                              Command="{Binding DataContext.Commands.StopGatewayCommand,
                                                RelativeSource={RelativeSource AncestorType=UserControl}}"
                              CommandParameter="{Binding}"/>

                      <!-- Row 2 -->
                      <Button Grid.Row="2" Grid.Column="0"
                              Content="⟳"
                              ToolTip.Tip="Restart"
                              Command="{Binding DataContext.Commands.RestartGatewayCommand,
                                                RelativeSource={RelativeSource AncestorType=UserControl}}"
                              CommandParameter="{Binding}"/>

                      <Button Grid.Row="2" Grid.Column="2"
                              Content="Rebuild"
                              Command="{Binding DataContext.Commands.RebuildGatewayCommand,
                                                RelativeSource={RelativeSource AncestorType=UserControl}}"
                              CommandParameter="{Binding}"/>

                      <Button Grid.Row="2" Grid.Column="4"
                              Content="Logs"
                              ToolTip.Tip="Clear Logs"
                              Command="{Binding DataContext.Commands.ClearSelectedLogsCommand,
                                                RelativeSource={RelativeSource AncestorType=UserControl}}"
                              CommandParameter="{Binding}"/>
                    </Grid>

                  </Grid>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
          </ListBox>
        </Grid>
      </Border>

      <!-- spacer -->
      <Border Grid.Column="1" Background="Transparent"/>

      <!-- ================= RIGHT: LOG PANES ================= -->
      <Grid Grid.Column="2"
            RowDefinitions="120,*,*,Auto"
            ClipToBounds="True">

        <!-- Row 0: Out / Err -->
        <Grid Grid.Row="0"
              ColumnDefinitions="*,8,*"
              Margin="0,0,0,8">

          <Border Grid.Column="0"
                  BorderBrush="#444"
                  BorderThickness="1"
                  Padding="8">
            <TextBox Text="{Binding Docker.Units.SelectedUnit.Logs.DockerOutBuffer}"
                     CaretIndex="{Binding Docker.Units.SelectedUnit.Logs.DockerOutCaret}"
                     TextWrapping="Wrap"
                     FontFamily="Consolas, Menlo, monospace"
                     IsReadOnly="True"
                     AcceptsReturn="True"
                     Background="#0b0b0b"
                     Foreground="#d8d8d8"
                     BorderThickness="0"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"/>
          </Border>

          <Border Grid.Column="2"
                  BorderBrush="#444"
                  BorderThickness="1"
                  Padding="8">
            <TextBox Text="{Binding Docker.Units.SelectedUnit.Logs.DockerErrBuffer}"
                     CaretIndex="{Binding Docker.Units.SelectedUnit.Logs.DockerErrCaret}"
                     TextWrapping="Wrap"
                     FontFamily="Consolas, Menlo, monospace"
                     IsReadOnly="True"
                     AcceptsReturn="True"
                     Background="#0b0b0b"
                     Foreground="#d8d8d8"
                     BorderThickness="0"
                     ScrollViewer.VerticalScrollBarVisibility="Auto"/>
          </Border>
        </Grid>

        <!-- Row 1: Gateway -->
        <Border Grid.Row="1"
                BorderBrush="#444"
                BorderThickness="1"
                Margin="0,0,0,8"
                Padding="8">
          <TextBox Text="{Binding Docker.Units.SelectedUnit.Logs.GatewayLogBuffer}"
                   CaretIndex="{Binding Docker.Units.SelectedUnit.Logs.GatewayLogCaret}"
                   TextWrapping="Wrap"
                   FontFamily="Consolas, Menlo, monospace"
                   IsReadOnly="True"
                   AcceptsReturn="True"
                   Background="#0b0b0b"
                   Foreground="#d8d8d8"
                   BorderThickness="0"
                   ScrollViewer.VerticalScrollBarVisibility="Auto"/>
        </Border>

        <!-- Row 2: Container IO -->
        <Border Grid.Row="2"
                BorderBrush="#444"
                BorderThickness="1"
                Margin="0,0,0,8"
                Padding="8">
          <TextBox Text="{Binding Docker.Units.SelectedUnit.Logs.ContainerIOBuffer}"
                   CaretIndex="{Binding Docker.Units.SelectedUnit.Logs.ContainerIOCaret}"
                   TextWrapping="Wrap"
                   FontFamily="Consolas, Menlo, monospace"
                   IsReadOnly="True"
                   AcceptsReturn="True"
                   Background="#0b0b0b"
                   Foreground="#d8d8d8"
                   BorderThickness="0"
                   ScrollViewer.VerticalScrollBarVisibility="Auto"/>
        </Border>

        <!-- Row 3: Input -->
        <TextBox x:Name="ContainerCmdBox"
                 Grid.Row="3"
                 AcceptsReturn="True"
                 MaxHeight="200"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 Watermark="Befehl im Container ausführen (z. B. pip list)"
                 Text="{Binding Docker.Controller.ContainerCommand, Mode=TwoWay}">
          <TextBox.KeyBindings>
            <KeyBinding Gesture="Enter"
                        Command="{Binding Commands.ExecuteInContainerCommand}"
                        CommandParameter="{Binding Text, ElementName=ContainerCmdBox}" />
          </TextBox.KeyBindings>
        </TextBox>

      </Grid>

    </Grid>
  </Grid>
</UserControl>
